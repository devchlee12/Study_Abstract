### 이미지 vs 컨테이너
- 이미지
	- 컨테이너를 위한 청사진
	- 코드, 필요한 툴, 실행환경을 포함
	- read only
	- application data 포함 안됨
- 컨테이너
	- 실행중인 소프트웨어 단위
	- 하나의 이미지로 여러개의 컨테이너 생성 가능
	- read and write
	- 꺼지면 data 손실
### 이미지는 어떻게 구하지?
- 이미 존재하는 이미지 사용
	- 도커허브 이용
- 나만의 커스텀 이미지 만들기
	- 도커파일을 작성해서 만들 수 있음

### Dockerfile 사용해서 자체이미지 빌드하기
- Dockerfile 작성법
	- FROM
		- 베이스 이미지를 설정
		- 시스템에 존재하거나 도커허브에 존재하는 이름 지정
		- 예를 들어 FROM node라고 적으면, node이미지를 가져온다.
	- COPY
		- 로컬머신의 어떤 파일이 이미지에 들어가야하는지 지정
		- COPY '컨테이너 외부 로컬파일 경로' '컨테이너 내부 경로'
			- 예를 들어, COPY . /app 은
			- 현재 폴더에 있는 파일들(Dockerfile 제외)을 컨테이너 내부 /app 폴더에 저장
	- RUN
		- 이미지가 생성될 때 실행시키고 싶은 명령어
		- 작업 디렉토리는 컨테이너 파일시스템의 루트 폴더
	- WORKDIR
		- 명령어의 작업 디렉토리를 지정 가능
	- CMD
		- 컨테이너가 실행될 때 실행시키고 싶은 명령어
		- 배열로 전달
			- CMD \["node", "server.js"] 
	- EXPOSE
		- 로컬시스템에 노출할 포트를 적는 곳
		- CMD명령어의 이전에 작성해야한다
		- 사실 문서화 목적임
			- 실제로 기능은 없다
			- 없어도 딱히 기능에 문제는 없는데 권장
- docker build로 이미지 빌드
	-  docker build '이미지 저장할 곳'
		- docker build .
### 자체 이미지를 기반으로 컨테이너 실행하기
- docker run
	- docker run 'ID'
		- 전체 ID를 넣을 필요는 없고, 식별할 수 있을만큼만 넣어도 됨
	- 이미지기반으로 컨테이너 실행
	- p플래그
		- 로컬 포트와 컨테이너 포트 연결
- docker ps
	- 실행중인 컨테이너 조회
	- a옵션 주면 종료된 컨테이너도 조회 가능
- docker stop
	- docker stop 'name'
	- 컨테이너 종료
### 이미지는 읽기 전용이다!
- 도커이미지는 빌드되는 당시의 스냅샷을 저장한다
- 그래서 코드를 변경했다면 다시 빌드해서 이미지를 새로 만들어야 함

### 이미지 레이어 이해하기
- 이미지는 레이어 기반 아키텍처를 따른다
	- 도커 파일에 적혀있는 명령어들을 순서대로 실행하면서 레이어를 만듬
	- 이는 캐싱을 적용해서 빠르게 빌드할 수 있게하기 위함임
	- 어떤 레이어에서 변경이 발생하면 그 위의 레이어도 전부 다시 실행
		- 그래서 도커파일의 순서를 잘 조정해서 최적화 가능

### 컨테이너 중지, 재시작
- 중지한 컨테이너는 어떻게 시작할까?
	- docker run으로 실행하면 새로운 컨테이너가 실행됨
	- docker start로 재시작해야함

### Attached & Detached 컨테이너
- attach 모드
	- 콘솔의 출력결과를 볼 수 있는 대신 포어그라운드에서 실행되어서 다른거 못함
	- docker run으로 실행했을 때의 기본 설정
	- docker start로 실행할 때는 a옵션 줘야함
	- docker log로 출력결과 볼 수도 있음
	- docker attach하면 detach모드에서 attach모드로 전환
- detach 모드
	- 컨테이너가 백그라운드에서 실행됨
	- docker start로 실행했을 때의 기본 설정
	- docker run으로 실행할 때는 d옵션줘야함

### 인터렉티브 모드로 들어가기
- attach모드라고 하더라도, 도커안에서 입력을 줄 수는 없음
- 그래서 interactive모드를 활성화 해야됨
- docker run -it ID
	- i옵션 : interactive mode
	- t옵션 : pseudo tty(터미널)
- 그렇다면 재시작할 때는 어떻게 해야할까?
	- docker start -ai ID
		- attach모드와 interactive모드 활성화하는 것
		- t옵션을 안줘도 되는 이유는 run할 때 주었기 때문에
### 이미지 & 컨테이너 삭제하기
- ps -a로 중지되거나 실행중인 컨테이너 확인
- rm ID로 중지된 컨테이너 삭제
	- 실행중이면 먼저 stop시켜야함
- 컨테이너를 삭제하고 나면 이미지를 삭제할 수 있음
- docker images로 존재하는 이미지들 확인
- rmi ID로 이미지 삭제
	- 해당 이미지로 실행했던 컨테이너들을 모두 삭제해야 이미지 삭제 가능
### 중지된 컨테이너 자동 제거하기
- docker run 에서 --rf옵션을 주면 컨테이너를 중지했을 떄 자동으로 컨테이너를 제거할 수 있음
### 이미지 검사
- docker image inspect ID
	- 도커 이미지가 어떤 레이어로 이루어져 있는지 검사 가능
### 컨테이너에/컨테이너로 부터 파일 복사하기
- docker cp 이미지 이름:경로 경로
	- 컨테이너에서 로컬로
- docker cp 경로 이미지 이름:경로
	- 로컬에서 컨테이너로
- 컨테이너 내부의 로그를 가져오고 싶을 때 사용 가능
- 일반적으로 로컬파일을 컨테이너에 넣는 것은 권장하지 않는다
	- 오류가 날 수 있음
### 컨테이너와 이미지에 이름 설정하기
- 컨테이너에 이름 설정
	- docker run에서 --name 옵션을 주면됨
- 이미지에 이름 설정
	- 이미지의 이름은 Image tag라고 부름
	- docker build에서 -t옵션 주면 됨
		- docker build -t name:tag
			- 이미지 태그가 name 과tag로 분리된 이유는, 버전을 나누기 위함

### 이미지 공유하기
- 이미지를 공유하는 방법에는 크게 두가지가 있다
	- 도커 파일을 공유
		- 프로젝트의 폴더와 파일들이 존재해야함
		- docker build . 로 빌드해서 이미지 만들고 사용 
	- 빌드된 이미지를 공유
		- 그냥 이미지를 다운로드해서 사용
		- 빌드과정 필요없고 그냥 바로 실행 가능

### 도커허브에 이미지 푸시하기
- 이미지를 푸시할 때는 도커허브나 Private registry를 사용가능
	- 도커허브
		- 공식 도커 이미지 레지스트리
		- public, private, official 이미지들 존재
	- private registry
		- 여러 제공업체가 존재
- 도커허브에 이미지 푸시하는 방법
	- 도커 허브에 가입하고 리포지토리만들기
	- 리포지토리 이름 대로 도커 이미지 빌드하고 푸쉬
		- docker push IMAGE_NAME
	- 만약 컴퓨터가 도커허브에 로그인이 안되어있다면 access denied됨
		- 그럴 땐 docker login